!function(a,b){var c;a.challengeWidget=function(b,f,g){c=this;var h={topN:void 0,tp:void 0,showRegButton:!0,daily:!1,fixed:!1,whiteLabel:"AvaTrade",lang:"en",servicesDomain:"https://services.avaapiweb.com/",myAvaDomain:"https://myvip.avatrade.com/",myAvaWebroot:"myava/",joinUrl:"https://myvip.avatrade.com/register/step1/2?tag=",token:null,relevantUser:null,tag:null};c.config=Object.assign({},h,g);var i={USD:"$",EUR:"€",GBP:"£",JPY:"¥",CNY:"¥",AUD:"AU$",ILS:"₪"},k={AvaTrade:"AvaTrade_logo_2012-1.png",ATRADE:"Atrade_Logo.png",Sentry:"Sentry_Logo.png",AvaJapan:"AvaTrade_logo_2012-1.png",LatinPlusTrader:"LatinPlusTrader.jpg",CryptoX:"Crypto-X.jpg",FriedbergDirectAVA:"AvaFriedberg_logos.png"};c.config.whiteLabelLogo=k[c.config.whiteLabel.replace("-","")],c.updateEquity=function(a){if(a||0===a){var b=document.getElementById("challengeUserEquity");b&&(b.textContent=a)}};var l=new XMLHttpRequest;l.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var a=JSON.parse(this.responseText);c.challengeData={expirationDays:a.expiration_days,prizeAmount:a.prize_ammount,prizeCurrency:a.prize_currency,users:a.users,totalUsers:a.total_users,challengeName:a.challenge_name,initialAmount:a.initial_amount},c.challengeData.currencySymbol=i[c.challengeData.prizeCurrency]||c.challengeData.prizeCurrency,"function"==typeof c.config.cbChallengeReady&&c.config.cbChallengeReady(c.challengeData),c.layoutData={rowsAdded:0},c.config.isFixed=Boolean(c.config.fixed),c.challengeData.relevantUser=c.config.relevantUser,j(b,c.config.lang)}};var m=d(),n=e(f);l.open("POST",m),l.setRequestHeader("Content-Type","application/json"),l.setRequestHeader("Access-Control-Allow-Origin",a.location.origin),l.send(JSON.stringify(n)),t()};var d=function(a){var b=c.config.servicesDomain+"api/challenge";return b},e=function(a){var b={ChallengeId:a,IsDaily:c.config.daily,TopUsers:c.config.topN,TpNumber:c.config.tp,Token:c.config.token,Tag:c.config.tag};return b},f=function(a){var c=b.createElement(a);return c},g=function(a,b){var c=f(a);return void 0!==b&&h(c,b),c},h=function(a,b){b.split(" ").forEach(function(b){a.classList.add(b)})},i=function(a,b){a.src=b},j=function(a,b){"en"==b.substring(0,2)&&(b="en");var d=c.config.myAvaDomain+"/app/languages/_widget/challengeWidget/"+b+".js",e=v("GET",d);return e?(e.onload=function(){if(200==e.status){var b=e.responseText;c.translation=JSON.parse("["+b+"]")[0]}else{var b={widgetTitle:"Super Trader Competition",widgetSubtitle:"Join top traders as they compete for [DAYS] days for a prize of [CURRENCY][AMOUNT].",tableHeaderFull:"Here are the top traders leading the competition",tableHeaderFixed:"Top [TOP_N] Super Traders",tableHeaderJoin:"Join top traders at [WHITE_LABEL] as they compete for [CURRENCY][AMOUNT].",tableColumnRank:"#Rank",tableColumnTraderInitial:"Trader's Initial",tableColumnEquity:"Equity",footerButtonJoin:"Join Competition",asideTitleRank:"My Rank",asideTitleJoin:"Join Competition Now",footerMyEquity:"My Equity: "};c.translation=b}k(a)},e.onerror=function(){var b={widgetTitle:"Super Trader Competition",widgetSubtitle:"Join top traders as they compete for [DAYS] days for a prize of [CURRENCY][AMOUNT].",tableHeaderFull:"Here are the top traders leading the competition",tableHeaderFixed:"Top [TOP_N] Super Traders",tableHeaderJoin:"Join top traders at [WHITE_LABEL] as they compete for [CURRENCY][AMOUNT].",tableColumnRank:"#Rank",tableColumnTraderInitial:"Trader's Initial",tableColumnEquity:"Equity",footerButtonJoin:"Join Competition",asideTitleRank:"My Rank",asideTitleJoin:"Join Competition Now",footerMyEquity:"My Equity: "};c.translation=b,k(a)},void e.send()):void alert("CORS not supported")},k=function(a){var b="challenge-widget flex-column flex-align-center flex-justify-center";c.config.fixed&&(b+=" fixed");var d=g("div",b),e=g("div","container flex-row");if(c.config.fixed){var f=l();e.appendChild(f)}var h=m();e.appendChild(h),d.appendChild(e),a.appendChild(d)},l=function(){var a="user-rank";if(c.challengeData.relevantUser){var d=c.config.myAvaDomain+"images/challenge_medal.svg",e=c.translation.asideTitleRank;a+=" flex-two"}else{var d=c.config.myAvaDomain+"images/challenge_join.png",e=c.translation.asideTitleJoin;a+=" flex-three"}var h=g("aside","flex-column flex-one clickable"),j=g("div","aside-content flex-column flex-align-center flex-justify-center flex-one"),k=g("img","flex-one flex-grow-0");i(k,d),j.appendChild(k);var l=g("div",a);if(l.setAttribute("data-text",e),j.appendChild(l),c.challengeData.relevantUser){var m=g("div","flex-one"),n=c.challengeData.relevantUser&&c.challengeData.relevantUser.rank||c.challengeData.totalUsers;m.innerHTML=n+"/<br>";var o=f("span");o.textContent=c.challengeData.totalUsers,m.appendChild(o),j.appendChild(m)}var p=g("div","full-width clickable");h.addEventListener("click",function(a,c){b.getElementsByClassName("challenge-widget")[0].classList.toggle("opened")});var q=g("img","arrow");return i(q,c.config.myAvaDomain+"images/challenge_arrow.png"),p.appendChild(q),j.appendChild(p),h.appendChild(j),h},m=function(){var a=g("div","main-wrapper flex-three"),b=g("div","main");if(!c.config.fixed){var d=n();b.appendChild(d),b.appendChild(f("hr"))}var e=o();b.appendChild(e);var h=r();return b.appendChild(h),a.appendChild(b),a},n=function(){var a=g("div","header flex-column"),b=g("img","logo");a.appendChild(b),i(b,c.config.myAvaDomain+"images/logo/"+c.config.whiteLabelLogo);var d=g("h2","title"),e=c.translation.widgetTitle;d.textContent=e,a.appendChild(d);var f=g("h3","subtitle reset-defaults"),h=c.translation.widgetSubtitle;return h=h.replace("[DAYS]",c.challengeData.expirationDays),h=h.replace("[CURRENCY]",c.challengeData.currencySymbol),h=h.replace("[AMOUNT]",c.challengeData.prizeAmount),f.textContent=h,a.appendChild(f),a},o=function(){var a=g("div","challenge-table flex-column flex-align-center"),b=g("div","flex-row");if(!c.config.fixed){var d=f("img");i(d,c.config.myAvaDomain+"images/challenge_trophy.svg"),b.appendChild(d)}var e=f("h3");if(c.config.fixed)if(c.challengeData.relevantUser){var h=c.translation.tableHeaderFull.replace("[TOP_N]",c.config.topN);e.textContent=h}else e.textContent=c.translation.widgetTitle;else e.textContent=c.translation.tableHeaderFull;if(b.appendChild(e),a.appendChild(b),c.config.fixed&&!c.challengeData.relevantUser){var j=g("h3","subtitle reset-defaults"),k=c.translation.tableHeaderJoin;k=k.replace("[WHITE_LABEL]",c.config.whiteLabel),k=k.replace("[CURRENCY]",c.challengeData.currencySymbol),k=k.replace("[AMOUNT]",c.challengeData.prizeAmount),j.textContent=k,a.appendChild(j)}else challengeTableT=f("table"),challengeTableHeaderTR=p(),challengeTableT.appendChild(challengeTableHeaderTR),c.challengeData.users.sort(function(a,b){return a.rank-b.rank}).forEach(function(a,b){(!c.config.topN||b<c.config.topN)&&challengeTableT.appendChild(q(a))}),a.appendChild(challengeTableT);return a},p=function(){var a=g("tr"),b=f("th");b.textContent=c.translation.tableColumnRank,b.width="25%",a.appendChild(b);var d=f("th");d.textContent=c.translation.tableColumnTraderInitial,d.width="50%",a.appendChild(d);var e=f("th");return e.textContent=c.translation.tableColumnEquity,e.width="25%",a.appendChild(e),a},q=function(a){var b=f("tr");c.layoutData.rowsAdded++%2===0&&h(b,"even");var d=f("td");d.textContent=a.rank,b.appendChild(d);var e=f("td");e.textContent=a.initials,b.appendChild(e);var g=f("td");return g.textContent=c.challengeData.currencySymbol+s(a.equity),b.appendChild(g),b},r=function(){var a=f("footer");if(c.config.fixed&&c.challengeData.relevantUser){var b=f("h3");b.innerHTML=c.translation.footerMyEquity;var d=f("span");d.textContent=c.challengeData.currencySymbol;var e=f("span");e.setAttribute("id","challengeUserEquity"),e.textContent=s(c.challengeData.relevantUser.equity),b.appendChild(d),b.appendChild(e),a.appendChild(b)}else if(c.config.showRegButton){var g=f("button");g.textContent=c.translation.footerButtonJoin,g.onclick=function(){window.location=c.config.joinUrl+(c.config.tag?c.config.tag:"")},a.appendChild(g)}return a},s=function(a){return(+(+a).toFixed(0)).toLocaleString()},t=function(){u()},u=function(){var a=b.getElementsByTagName("head")[0],d=b.createElement("link");d.setAttribute("rel","stylesheet"),d.setAttribute("href",c.config.myAvaDomain+"/widgets/challenge/css/challengeWidget.css"),a.appendChild(d)},v=function(a,b){var c=new XMLHttpRequest;return"withCredentials"in c?c.open(a,b,!0):"undefined"!=typeof XDomainRequest?(c=new XDomainRequest,c.open(a,b)):c=null,c}}(window,document);